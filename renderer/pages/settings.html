<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>设置</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script src="https://unpkg.com/@element-plus/icons-vue/dist/index.iife.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        #app {
            height: 100vh;
            display: flex;
            background: #f5f7fa;
        }

        .sidebar {
            width: 280px;
            background: #ffffff;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            z-index: 1;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid #e4e7ed;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .sidebar-title {
            font-size: 24px;
            font-weight: 600;
            margin: 0;
        }

        .sidebar-subtitle {
            font-size: 14px;
            opacity: 0.8;
            margin: 4px 0 0 0;
        }

        .main-content {
            flex: 1;
            overflow-y: auto;
            background: #f5f7fa;
        }

        .content-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 32px;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 600;
            color: #303133;
            margin: 0 0 8px 0;
        }

        .page-subtitle {
            font-size: 16px;
            color: #606266;
            margin: 0;
        }

        .settings-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
            margin-bottom: 24px;
            overflow: hidden;
        }

        .section-header {
            padding: 20px 24px;
            border-bottom: 1px solid #f0f2f5;
            background: #fafbfc;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #303133;
            margin: 0 0 4px 0;
        }

        .section-description {
            font-size: 14px;
            color: #909399;
            margin: 0;
        }

        .section-content {
            padding: 24px;
        }

        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid #f0f2f5;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            flex: 1;
            margin-right: 16px;
        }

        .setting-name {
            font-size: 16px;
            font-weight: 500;
            color: #303133;
            margin: 0 0 4px 0;
        }

        .setting-desc {
            font-size: 14px;
            color: #909399;
            margin: 0;
        }

        .setting-control {
            min-width: 200px;
        }

        .el-menu {
            border-right: none;
        }

        .el-menu-item {
            height: 48px;
            line-height: 48px;
            margin: 4px 12px;
            border-radius: 8px;
        }

        .el-menu-item.is-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .el-menu-item:hover {
            background: #f5f7fa;
        }

        .el-menu-item.is-active:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .custom-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
        }

        .custom-button:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- 侧边栏 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1 class="sidebar-title">设置</h1>
                <p class="sidebar-subtitle">配置您的浏览器偏好</p>
            </div>
            <el-menu 
                :default-active="activeSection"
                @select="handleSectionChange"
                mode="vertical"
            >
                <el-menu-item index="startup">
                    <el-icon><HomeFilled /></el-icon>
                    <span>启动设置</span>
                </el-menu-item>
                <el-menu-item index="homepage">
                    <el-icon><House /></el-icon>
                    <span>主页设置</span>
                </el-menu-item>
                <el-menu-item index="newtab">
                    <el-icon><Plus /></el-icon>
                    <span>新标签页</span>
                </el-menu-item>
                <el-menu-item index="proxy">
                    <el-icon><Connection /></el-icon>
                    <span>代理设置</span>
                </el-menu-item>
                <el-menu-item index="about">
                    <el-icon><InfoFilled /></el-icon>
                    <span>关于</span>
                </el-menu-item>
            </el-menu>
        </div>

        <!-- 主内容 -->
        <div class="main-content">
            <div class="content-container">
                <div class="page-header">
                    <h1 class="page-title">{{ currentSectionTitle }}</h1>
                    <p class="page-subtitle">{{ currentSectionDesc }}</p>
                </div>

                <!-- 启动设置 -->
                <div v-show="activeSection === 'startup'" class="settings-section">
                    <div class="section-header">
                        <h2 class="section-title">启动选项</h2>
                        <p class="section-description">配置浏览器启动时的默认行为</p>
                    </div>
                    <div class="section-content">
                        <div class="setting-item">
                            <div class="setting-label">
                                <h3 class="setting-name">启动时打开</h3>
                                <p class="setting-desc">选择浏览器启动时显示的页面</p>
                            </div>
                            <div class="setting-control">
                                <el-select v-model="settings.startupOption" @change="saveSettings">
                                    <el-option label="主页" value="homepage"></el-option>
                                    <el-option label="新标签页" value="newtab"></el-option>
                                    <el-option label="自定义网址" value="custom"></el-option>
                                </el-select>
                            </div>
                        </div>
                        <div v-show="settings.startupOption === 'custom'" class="setting-item">
                            <div class="setting-label">
                                <h3 class="setting-name">自定义启动网址</h3>
                                <p class="setting-desc">输入启动时要打开的网址</p>
                            </div>
                            <div class="setting-control">
                                <el-input 
                                    v-model="settings.startupCustomUrl"
                                    @change="saveSettings"
                                    placeholder="https://www.google.com"
                                />
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 主页设置 -->
                <div v-show="activeSection === 'homepage'" class="settings-section">
                    <div class="section-header">
                        <h2 class="section-title">主页设置</h2>
                        <p class="section-description">自定义您的浏览器主页</p>
                    </div>
                    <div class="section-content">
                        <div class="setting-item">
                            <div class="setting-label">
                                <h3 class="setting-name">主页</h3>
                                <p class="setting-desc">选择点击主页按钮时显示的页面</p>
                            </div>
                            <div class="setting-control">
                                <el-select v-model="settings.homepageOption" @change="saveSettings">
                                    <el-option label="新标签页" value="newtab"></el-option>
                                    <el-option label="自定义网址" value="custom"></el-option>
                                </el-select>
                            </div>
                        </div>
                        <div v-show="settings.homepageOption === 'custom'" class="setting-item">
                            <div class="setting-label">
                                <h3 class="setting-name">自定义主页网址</h3>
                                <p class="setting-desc">输入主页网址</p>
                            </div>
                            <div class="setting-control">
                                <el-input 
                                    v-model="settings.homepageCustomUrl"
                                    @change="saveSettings"
                                    placeholder="https://www.google.com"
                                />
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 新标签页设置 -->
                <div v-show="activeSection === 'newtab'" class="settings-section">
                    <div class="section-header">
                        <h2 class="section-title">新标签页</h2>
                        <p class="section-description">配置新标签页的显示内容</p>
                    </div>
                    <div class="section-content">
                        <div class="setting-item">
                            <div class="setting-label">
                                <h3 class="setting-name">新标签页显示</h3>
                                <p class="setting-desc">选择新标签页的默认内容</p>
                            </div>
                            <div class="setting-control">
                                <el-select v-model="settings.newtabOption" @change="saveSettings">
                                    <el-option label="空白页" value="blank"></el-option>
                                    <el-option label="自定义网址" value="custom"></el-option>
                                </el-select>
                            </div>
                        </div>
                        <div v-show="settings.newtabOption === 'custom'" class="setting-item">
                            <div class="setting-label">
                                <h3 class="setting-name">自定义新标签页网址</h3>
                                <p class="setting-desc">输入新标签页要显示的网址</p>
                            </div>
                            <div class="setting-control">
                                <el-input 
                                    v-model="settings.newtabCustomUrl"
                                    @change="saveSettings"
                                    placeholder="https://www.google.com"
                                />
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 代理设置 -->
                <div v-show="activeSection === 'proxy'" class="settings-section">
                    <div class="section-header">
                        <h2 class="section-title">代理配置</h2>
                        <p class="section-description">管理 Clash.Meta 代理设置</p>
                    </div>
                    <div class="section-content">
                        <div class="setting-item">
                            <div class="setting-label">
                                <h3 class="setting-name">代理状态</h3>
                                <p class="setting-desc">当前代理服务运行状态</p>
                            </div>
                            <div class="setting-control">
                                <el-tag :type="proxyStatus === '运行中' ? 'success' : 'danger'">
                                    {{ proxyStatus }}
                                </el-tag>
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-label">
                                <h3 class="setting-name">代理面板</h3>
                                <p class="setting-desc">打开 Clash.Meta 控制面板</p>
                            </div>
                            <div class="setting-control">
                                <el-button 
                                    type="primary" 
                                    class="custom-button"
                                    @click="openProxyDashboard"
                                >
                                    打开面板
                                </el-button>
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-label">
                                <h3 class="setting-name">配置文件</h3>
                                <p class="setting-desc">查看当前的代理配置</p>
                            </div>
                            <div class="setting-control">
                                <el-button @click="viewConfig">查看配置</el-button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 关于 -->
                <div v-show="activeSection === 'about'" class="settings-section">
                    <div class="section-header">
                        <h2 class="section-title">关于 PrismBrowser</h2>
                        <p class="section-description">应用程序信息和版本详情</p>
                    </div>
                    <div class="section-content">
                        <div class="setting-item">
                            <div class="setting-label">
                                <h3 class="setting-name">版本</h3>
                                <p class="setting-desc">当前应用程序版本</p>
                            </div>
                            <div class="setting-control">
                                <el-tag>{{ appVersion }}</el-tag>
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-label">
                                <h3 class="setting-name">Electron</h3>
                                <p class="setting-desc">Electron 框架版本</p>
                            </div>
                            <div class="setting-control">
                                <el-tag type="info">{{ electronVersion }}</el-tag>
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-label">
                                <h3 class="setting-name">开源许可</h3>
                                <p class="setting-desc">本项目使用 MIT 许可证</p>
                            </div>
                            <div class="setting-control">
                                <el-button @click="openGitHub">查看源码</el-button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        const { ElMessage } = ElementPlus;

        createApp({
            data() {
                return {
                    activeSection: 'startup',
                    settings: {
                        startupOption: 'homepage',
                        startupCustomUrl: 'https://www.google.com',
                        homepageOption: 'custom',
                        homepageCustomUrl: 'https://www.google.com',
                        newtabOption: 'blank',
                        newtabCustomUrl: 'https://www.google.com'
                    },
                    proxyStatus: '检查中...',
                    appVersion: '1.0.0',
                    electronVersion: '34.5.8'
                };
            },
            computed: {
                currentSectionTitle() {
                    const titles = {
                        startup: '启动设置',
                        homepage: '主页设置', 
                        newtab: '新标签页',
                        proxy: '代理设置',
                        about: '关于'
                    };
                    return titles[this.activeSection] || '设置';
                },
                currentSectionDesc() {
                    const descriptions = {
                        startup: '配置浏览器启动时的默认行为',
                        homepage: '自定义您的浏览器主页',
                        newtab: '配置新标签页的显示内容',
                        proxy: '管理 Clash.Meta 代理设置',
                        about: '应用程序信息和版本详情'
                    };
                    return descriptions[this.activeSection] || '';
                }
            },
            async mounted() {
                await this.loadSettings();
                this.checkProxyStatus();
            },
            methods: {
                handleSectionChange(section) {
                    this.activeSection = section;
                },
                async loadSettings() {
                    try {
                        const keys = [
                            'settings.startupOption',
                            'settings.startupCustomUrl', 
                            'settings.homepageOption',
                            'settings.homepageCustomUrl',
                            'settings.newtabOption',
                            'settings.newtabCustomUrl'
                        ];
                        
                        for (const key of keys) {
                            const value = await window.api.getSetting(key);
                            if (value !== undefined) {
                                const settingKey = key.replace('settings.', '');
                                this.settings[settingKey] = value;
                            }
                        }
                    } catch (error) {
                        console.error('加载设置失败:', error);
                    }
                },
                async saveSettings() {
                    try {
                        for (const [key, value] of Object.entries(this.settings)) {
                            await window.api.setSetting(`settings.${key}`, value);
                        }
                        ElMessage.success('设置已保存');
                    } catch (error) {
                        console.error('保存设置失败:', error);
                        ElMessage.error('保存设置失败');
                    }
                },
                checkProxyStatus() {
                    // 简单的代理状态检查
                    fetch('http://127.0.0.1:9090/version')
                        .then(() => {
                            this.proxyStatus = '运行中';
                        })
                        .catch(() => {
                            this.proxyStatus = '未运行';
                        });
                },
                openProxyDashboard() {
                    window.api.openInNewTab('prism://dashboard');
                },
                viewConfig() {
                    window.api.getClashConfig().then(config => {
                        this.$alert(config, '代理配置', {
                            confirmButtonText: '确定',
                            customClass: 'config-alert'
                        });
                    });
                },
                openGitHub() {
                    window.api.openInNewTab('https://github.com');
                }
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html> 