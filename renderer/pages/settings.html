<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>设置</title>
    <link rel="stylesheet" href="../styles/theme.css">
    <style>
        :root {
            --sidebar-width: 240px;
        }

        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden;
            display: flex;
            background-color: var(--app-bg-color-light);
            color: var(--text-color-primary);
        }

        /* --- 主布局 --- */
        #sidebar {
            width: var(--sidebar-width);
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 20px 12px;
            box-sizing: border-box;
            background-color: var(--app-bg-color);
            border-right: 1px solid var(--card-border);
        }
        #main-content {
            flex-grow: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            padding: 32px 64px;
        }
        
        /* --- 侧边栏 --- */
        #sidebar h1 {
            font-size: 22px;
            font-weight: 600;
            margin: 0 0 30px 12px;
        }
        #nav-list .nav-item {
            display: flex; align-items: center; padding: 10px 12px; border-radius: 6px;
            cursor: pointer; font-size: 15px; font-weight: 500;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        #nav-list .nav-item:hover { background-color: var(--button-hover-bg); }
        #nav-list .nav-item.active { 
            background-color: var(--button-primary-bg); 
            color: white; 
        }
        #nav-list .nav-item svg { 
            width: 20px; height: 20px; margin-right: 14px; 
            stroke: var(--text-color-secondary);
            transition: stroke 0.2s ease;
        }
        #nav-list .nav-item.active svg { stroke: white; }

        /* --- 内容卡片样式 --- */
        .setting-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 24px 32px;
            margin-bottom: 32px;
            border: 1px solid var(--card-border);
        }
        .setting-card h2 {
            font-size: 20px;
            font-weight: 600;
            margin-top: 0;
            margin-bottom: 8px;
        }
        .setting-card p {
            font-size: 14px;
            color: var(--text-muted);
            margin-top: 0;
            margin-bottom: 24px;
            line-height: 1.5;
        }
        .form-group {
            margin-bottom: 16px;
        }
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .form-group input[type="text"] {
            width: 100%;
            max-width: 550px;
            height: 38px;
            padding: 0 12px;
            box-sizing: border-box;
            border-radius: 6px;
            border: 1px solid var(--input-border);
            background-color: var(--input-bg);
            font-size: 14px;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .form-group input[type="text"]:focus {
            outline: none;
            border-color: var(--button-primary-bg);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        .checkbox-group label {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            font-size: 14px;
        }
        .checkbox-group input[type="checkbox"] {
            margin-right: 10px;
        }
        .actions {
            margin-top: 24px;
            text-align: right;
        }
        button {
            padding: 10px 20px; font-size: 14px; border-radius: 6px;
            border: 1px solid var(--input-border);
            cursor: pointer; font-weight: 500;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        button.primary {
            background-color: var(--button-primary-bg);
            color: white;
            border-color: var(--button-primary-bg);
        }
        button.primary:hover {
            background-color: var(--button-primary-hover-bg);
            border-color: var(--button-primary-hover-bg);
        }
        #clash-config {
            width: 100%;
            height: 400px;
            font-family: monospace;
            white-space: pre;
            overflow: auto;
            border: 1px solid var(--input-border);
            background-color: var(--input-bg);
            padding: 12px;
            box-sizing: border-box;
            border-radius: 6px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <aside id="sidebar">
        <h1>设置</h1>
        <nav id="nav-list">
            <div class="nav-item active" data-view="browser-settings">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                <span>浏览器</span>
            </div>
            <div class="nav-item" data-view="clash-settings">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.89 1.45l8 4A2 2 0 0 1 22 7.24v9.53a2 2 0 0 1-1.11 1.79l-8 4a2 2 0 0 1-1.79 0l-8-4A2 2 0 0 1 2 16.77V7.24a2 2 0 0 1 1.11-1.79l8-4a2 2 0 0 1 1.78 0z"></path><polyline points="2.32 6.16 12 11 21.68 6.16"></polyline><line x1="12" y1="22.76" x2="12" y2="11"></line></svg>
                <span>Clash</span>
            </div>
        </nav>
    </aside>

    <main id="main-content">
        <!-- 浏览器设置 -->
        <div id="browser-settings" class="view-content">
            <div class="setting-card">
                <h2>主页</h2>
                <p>浏览器启动时以及点击主页按钮时打开的页面。</p>
                <div class="form-group">
                    <label for="home-page-input">主页 URL</label>
                    <input type="text" id="home-page-input" placeholder="输入网址，例如 https://www.google.com">
                </div>
                <div class="actions">
                    <button id="save-home-page-btn" class="primary">保存</button>
                </div>
            </div>
            <div class="setting-card">
                <h2>新建标签页</h2>
                <p>点击"+"按钮时打开的页面。输入 <code>about:blank</code> 可打开空白页。</p>
                <div class="form-group">
                    <label for="new-tab-page-input">新标签页URL</label>
                    <input type="text" id="new-tab-page-input" placeholder="输入网址或 about:blank">
                </div>
                <div class="actions">
                    <button id="save-new-tab-page-btn" class="primary">保存</button>
                </div>
            </div>
            <div class="setting-card">
                <h2>清除浏览数据</h2>
                <p>清除浏览器生成的缓存文件和 Cookie，这有助于解决一些网站加载问题或保护您的隐私。</p>
                <div class="checkbox-group">
                     <label><input type="checkbox" id="clear-cache-check" checked> <span>清除缓存</span></label>
                     <label><input type="checkbox" id="clear-cookies-check" checked> <span>清除 Cookie</span></label>
                </div>
                <div class="actions">
                    <button id="clear-data-btn">立即清除</button>
                </div>
            </div>
        </div>

        <!-- Clash 设置 -->
        <div id="clash-settings" class="view-content" style="display: none;">
            <div class="setting-card">
                <h2>Clash 核心</h2>
                <p>管理内置的 Clash (Mihomo) 代理核心。如果遇到网络问题，尝试重启核心可能会解决问题。</p>
                 <div class="actions">
                    <button id="restart-clash-btn">重启 Clash 核心</button>
                </div>
            </div>
            <div class="setting-card">
                <h2>配置文件 (config.yaml)</h2>
                <p>这是当前 Clash 核心正在使用的配置文件。注意：此视图为只读，如需修改请直接编辑文件。</p>
                <div id="clash-config">正在加载...</div>
            </div>
        </div>
    </main>

    <script>
        // --- DOM Elements ---
        const navItems = document.querySelectorAll('.nav-item');
        const views = document.querySelectorAll('.view-content');
        const homePageInput = document.getElementById('home-page-input');
        const saveHomePageBtn = document.getElementById('save-home-page-btn');
        const newTabPageInput = document.getElementById('new-tab-page-input');
        const saveNewTabPageBtn = document.getElementById('save-new-tab-page-btn');
        const clearDataBtn = document.getElementById('clear-data-btn');
        const clashConfigDiv = document.getElementById('clash-config');
        const restartClashBtn = document.getElementById('restart-clash-btn');
        
        // --- Navigation ---
        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                const viewName = e.currentTarget.dataset.view;
                
                navItems.forEach(i => i.classList.remove('active'));
                e.currentTarget.classList.add('active');

                views.forEach(v => v.style.display = 'none');
                document.getElementById(viewName).style.display = 'block';
            });
        });

        // --- Browser Settings Logic ---
        saveHomePageBtn.addEventListener('click', async () => {
            const newUrl = homePageInput.value;
            if (newUrl && (newUrl.startsWith('http://') || newUrl.startsWith('https://'))) {
                await window.api.setSetting('settings.homePage', newUrl);
                alert('主页已保存！');
            } else {
                alert('请输入一个有效的网址 (以 http:// 或 https:// 开头)');
            }
        });
        
        saveNewTabPageBtn.addEventListener('click', async () => {
            const newUrl = newTabPageInput.value;
            if (newUrl) { // 允许任何字符串，包括 about:blank
                await window.api.setSetting('settings.newTabPage', newUrl);
                alert('新标签页设置已保存！');
            } else {
                alert('输入不能为空。');
            }
        });
        
        clearDataBtn.addEventListener('click', async () => {
            const dataTypes = [];
            if (document.getElementById('clear-cache-check').checked) dataTypes.push('cache');
            if (document.getElementById('clear-cookies-check').checked) dataTypes.push('cookies');
            
            if (dataTypes.length > 0 && confirm(`确定要清除选定的浏览数据吗？`)) {
                const result = await window.api.clearBrowsingData(dataTypes);
                if (result.success) {
                    alert('浏览数据已清除！');
                } else {
                    alert(`清除失败: ${result.error}`);
                }
            }
        });

        // --- Clash Settings Logic ---
        async function loadClashConfig() {
            const configText = await window.api.getClashConfig();
            clashConfigDiv.textContent = configText;
        }
        
        restartClashBtn.addEventListener('click', async () => {
            if (confirm('确定要重启Clash核心吗？')) {
                await window.api.restartClash();
                alert('Clash 核心已发送重启指令。');
            }
        });

        // --- Initialization ---
        async function init() {
            const savedHomePage = await window.api.getSetting('settings.homePage') || 'https://www.google.com';
            homePageInput.value = savedHomePage;
            
            const savedNewTabPage = await window.api.getSetting('settings.newTabPage') || 'about:blank';
            newTabPageInput.value = savedNewTabPage;

            loadClashConfig();
        }

        init();
    </script>
</body>
</html> 